## 属性文件
### 引入属性文件
- 方法一
```xml
<bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"
  p:location="classpath:com/pain/placeholder/jdbc.properties"
  p:fileEncoding="utf-8" />
```
- 方法二
```xml
<context:property-placeholder location="classpath:com/pain/placeholder/jdbc.properties" />
```

### PropertyPlaceholderConfigurer
`PropertyPlaceholderConfigurer` 使得 Bean 在配置时引用外部属性文件，`PropertyPlaceholderConfigurer` 实现了 `BeanFactoryPostProcessorBean` 接口

`PropertyPlaceholderConfigurer` 继承 `PropertyResourceConfigurer`，后者提供方法用于在属性使用前对属性列表中的属性进行转换
加密的属性文件

```java
public class DESUtils {
  private static Key key;
  private static String KEY_STR = "myKey";

  static {
    try {
      KeyGenerator generator = KeyGenerator.getInstance("DES");
      generator.init(new SecureRandom(KEY_STR.getBytes()));
      key = generator.generateKey();
      generator = null;
    } catch (Exception e) {
      throw new RuntimeException(e);
    }
  }

  public static String getEncryptString(String str) {
    BASE64Encoder base64en = new BASE64Encoder();
    try {
      byte[] strBytes = str.getBytes("UTF8");
      Cipher cipher = Cipher.getInstance("DES");
      cipher.init(Cipher.ENCRYPT_MODE, key);
      byte[] encryptStrBytes = cipher.doFinal(strBytes);
      return base64en.encode(encryptStrBytes);
    } catch (Exception e) {
      throw new RuntimeException(e);
    }
  }

  public static String getDecryptString(String str) {
    BASE64Decoder base64De = new BASE64Decoder();
    try {
      byte[] strBytes = base64De.decodeBuffer(str);
      Cipher cipher = Cipher.getInstance("DES");
      cipher.init(Cipher.DECRYPT_MODE, key);
      byte[] decryptStrBytes = cipher.doFinal(strBytes);
      return new String(decryptStrBytes, "UTF8");
    } catch (Exception e) {
      throw new RuntimeException(e);
    }
  }

  public static void main(String[] args) {
    for (String arg : args) {
      System.out.println(arg + ":" + getEncryptString(arg));
    }
  }
}
```

```java
public class EncryptPropertyPlaceholderConfigurer extends PropertyPlaceholderConfigurer {
  private String[] encryptPropNames = {"username", "password"};

  protected String convertProperty(String propertyName, String propertyValue) {
    if (isEncryptProp(propertyName)) {
      String decryptValue = DESUtils.getDecryptString(propertyValue);
      System.out.println(decryptValue);
      return decryptValue;
    } else {
      return propertyValue;
    }
  }

  private boolean isEncryptProp(String propertyName) {
    for (String encryptPropName : encryptPropNames) {
      if (encryptPropName.equals(propertyName)) {
        return true;
      }
    }
    return false;
  }
}
```

```xml
<bean class="com.pain.placeholder.EncryptPropertyPlaceholderConfigurer"
  p:location="classpath:com/pain/placeholder/jdbc.properties"
  p:fileEncoding="utf-8" />
```

### 属性文件自身引用
```
dbName=mall
url=jdbc:mysql://localhost:3306/${mall}
```


### 引用 Bean 属性值
```java
public class SysConfig {
  private int sessionTimeout;
  private int maxTabPageNum;
  private DataSource dataSource;

  public void initFromDB() {
    this.sessionTimeout = 30;
    this.maxTabPageNum = 10;
  }

  public int getSessionTimeout() {
    return sessionTimeout;
  }

  public int getMaxTabPageNum() {
    return maxTabPageNum;
  }

  public void setDataSource(DataSource dataSource) {
    this.dataSource = dataSource;
  }
}
```
```xml
<bean id="SysConfig" class="com.pain.prop.SysConfig"
  init-method="initFromDB"
  p:dataSource-ref="dataSource" />

<bean class="com.pain.prop.ApplicationManager"
  p:maxTabPageNum="#{sysConfig.maxTabPageNum}"
  p:sessionTimeout="#{sysConfig.sessionTimeout}" />
```